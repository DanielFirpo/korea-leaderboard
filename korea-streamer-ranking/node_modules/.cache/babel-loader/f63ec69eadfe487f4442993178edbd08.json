{"ast":null,"code":"const debug = require('debug')('extract-zip'); // eslint-disable-next-line node/no-unsupported-features/node-builtins\n\n\nconst {\n  createWriteStream,\n  promises: fs\n} = require('fs');\n\nconst getStream = require('get-stream');\n\nconst path = require('path');\n\nconst {\n  promisify\n} = require('util');\n\nconst stream = require('stream');\n\nconst yauzl = require('yauzl');\n\nconst openZip = promisify(yauzl.open);\nconst pipeline = promisify(stream.pipeline);\n\nclass Extractor {\n  constructor(zipPath, opts) {\n    this.zipPath = zipPath;\n    this.opts = opts;\n  }\n\n  async extract() {\n    debug('opening', this.zipPath, 'with opts', this.opts);\n    this.zipfile = await openZip(this.zipPath, {\n      lazyEntries: true\n    });\n    this.canceled = false;\n    return new Promise((resolve, reject) => {\n      this.zipfile.on('error', err => {\n        this.canceled = true;\n        reject(err);\n      });\n      this.zipfile.readEntry();\n      this.zipfile.on('close', () => {\n        if (!this.canceled) {\n          debug('zip extraction complete');\n          resolve();\n        }\n      });\n      this.zipfile.on('entry', async entry => {\n        /* istanbul ignore if */\n        if (this.canceled) {\n          debug('skipping entry', entry.fileName, {\n            cancelled: this.canceled\n          });\n          return;\n        }\n\n        debug('zipfile entry', entry.fileName);\n\n        if (entry.fileName.startsWith('__MACOSX/')) {\n          this.zipfile.readEntry();\n          return;\n        }\n\n        const destDir = path.dirname(path.join(this.opts.dir, entry.fileName));\n\n        try {\n          await fs.mkdir(destDir, {\n            recursive: true\n          });\n          const canonicalDestDir = await fs.realpath(destDir);\n          const relativeDestDir = path.relative(this.opts.dir, canonicalDestDir);\n\n          if (relativeDestDir.split(path.sep).includes('..')) {\n            throw new Error(`Out of bound path \"${canonicalDestDir}\" found while processing file ${entry.fileName}`);\n          }\n\n          await this.extractEntry(entry);\n          debug('finished processing', entry.fileName);\n          this.zipfile.readEntry();\n        } catch (err) {\n          this.canceled = true;\n          this.zipfile.close();\n          reject(err);\n        }\n      });\n    });\n  }\n\n  async extractEntry(entry) {\n    /* istanbul ignore if */\n    if (this.canceled) {\n      debug('skipping entry extraction', entry.fileName, {\n        cancelled: this.canceled\n      });\n      return;\n    }\n\n    if (this.opts.onEntry) {\n      this.opts.onEntry(entry, this.zipfile);\n    }\n\n    const dest = path.join(this.opts.dir, entry.fileName); // convert external file attr int into a fs stat mode int\n\n    const mode = entry.externalFileAttributes >> 16 & 0xFFFF; // check if it's a symlink or dir (using stat mode constants)\n\n    const IFMT = 61440;\n    const IFDIR = 16384;\n    const IFLNK = 40960;\n    const symlink = (mode & IFMT) === IFLNK;\n    let isDir = (mode & IFMT) === IFDIR; // Failsafe, borrowed from jsZip\n\n    if (!isDir && entry.fileName.endsWith('/')) {\n      isDir = true;\n    } // check for windows weird way of specifying a directory\n    // https://github.com/maxogden/extract-zip/issues/13#issuecomment-154494566\n\n\n    const madeBy = entry.versionMadeBy >> 8;\n    if (!isDir) isDir = madeBy === 0 && entry.externalFileAttributes === 16;\n    debug('extracting entry', {\n      filename: entry.fileName,\n      isDir: isDir,\n      isSymlink: symlink\n    });\n    const procMode = this.getExtractedMode(mode, isDir) & 0o777; // always ensure folders are created\n\n    const destDir = isDir ? dest : path.dirname(dest);\n    const mkdirOptions = {\n      recursive: true\n    };\n\n    if (isDir) {\n      mkdirOptions.mode = procMode;\n    }\n\n    debug('mkdir', {\n      dir: destDir,\n      ...mkdirOptions\n    });\n    await fs.mkdir(destDir, mkdirOptions);\n    if (isDir) return;\n    debug('opening read stream', dest);\n    const readStream = await promisify(this.zipfile.openReadStream.bind(this.zipfile))(entry);\n\n    if (symlink) {\n      const link = await getStream(readStream);\n      debug('creating symlink', link, dest);\n      await fs.symlink(link, dest);\n    } else {\n      await pipeline(readStream, createWriteStream(dest, {\n        mode: procMode\n      }));\n    }\n  }\n\n  getExtractedMode(entryMode, isDir) {\n    let mode = entryMode; // Set defaults, if necessary\n\n    if (mode === 0) {\n      if (isDir) {\n        if (this.opts.defaultDirMode) {\n          mode = parseInt(this.opts.defaultDirMode, 10);\n        }\n\n        if (!mode) {\n          mode = 0o755;\n        }\n      } else {\n        if (this.opts.defaultFileMode) {\n          mode = parseInt(this.opts.defaultFileMode, 10);\n        }\n\n        if (!mode) {\n          mode = 0o644;\n        }\n      }\n    }\n\n    return mode;\n  }\n\n}\n\nmodule.exports = async function (zipPath, opts) {\n  debug('creating target directory', opts.dir);\n\n  if (!path.isAbsolute(opts.dir)) {\n    throw new Error('Target directory is expected to be absolute');\n  }\n\n  await fs.mkdir(opts.dir, {\n    recursive: true\n  });\n  opts.dir = await fs.realpath(opts.dir);\n  return new Extractor(zipPath, opts).extract();\n};","map":{"version":3,"names":["debug","require","createWriteStream","promises","fs","getStream","path","promisify","stream","yauzl","openZip","open","pipeline","Extractor","constructor","zipPath","opts","extract","zipfile","lazyEntries","canceled","Promise","resolve","reject","on","err","readEntry","entry","fileName","cancelled","startsWith","destDir","dirname","join","dir","mkdir","recursive","canonicalDestDir","realpath","relativeDestDir","relative","split","sep","includes","Error","extractEntry","close","onEntry","dest","mode","externalFileAttributes","IFMT","IFDIR","IFLNK","symlink","isDir","endsWith","madeBy","versionMadeBy","filename","isSymlink","procMode","getExtractedMode","mkdirOptions","readStream","openReadStream","bind","link","entryMode","defaultDirMode","parseInt","defaultFileMode","module","exports","isAbsolute"],"sources":["C:/Users/DF/Documents/GitHub/KoreaStreamerRanking/korea-streamer-ranking/node_modules/extract-zip/index.js"],"sourcesContent":["const debug = require('debug')('extract-zip')\n// eslint-disable-next-line node/no-unsupported-features/node-builtins\nconst { createWriteStream, promises: fs } = require('fs')\nconst getStream = require('get-stream')\nconst path = require('path')\nconst { promisify } = require('util')\nconst stream = require('stream')\nconst yauzl = require('yauzl')\n\nconst openZip = promisify(yauzl.open)\nconst pipeline = promisify(stream.pipeline)\n\nclass Extractor {\n  constructor (zipPath, opts) {\n    this.zipPath = zipPath\n    this.opts = opts\n  }\n\n  async extract () {\n    debug('opening', this.zipPath, 'with opts', this.opts)\n\n    this.zipfile = await openZip(this.zipPath, { lazyEntries: true })\n    this.canceled = false\n\n    return new Promise((resolve, reject) => {\n      this.zipfile.on('error', err => {\n        this.canceled = true\n        reject(err)\n      })\n      this.zipfile.readEntry()\n\n      this.zipfile.on('close', () => {\n        if (!this.canceled) {\n          debug('zip extraction complete')\n          resolve()\n        }\n      })\n\n      this.zipfile.on('entry', async entry => {\n        /* istanbul ignore if */\n        if (this.canceled) {\n          debug('skipping entry', entry.fileName, { cancelled: this.canceled })\n          return\n        }\n\n        debug('zipfile entry', entry.fileName)\n\n        if (entry.fileName.startsWith('__MACOSX/')) {\n          this.zipfile.readEntry()\n          return\n        }\n\n        const destDir = path.dirname(path.join(this.opts.dir, entry.fileName))\n\n        try {\n          await fs.mkdir(destDir, { recursive: true })\n\n          const canonicalDestDir = await fs.realpath(destDir)\n          const relativeDestDir = path.relative(this.opts.dir, canonicalDestDir)\n\n          if (relativeDestDir.split(path.sep).includes('..')) {\n            throw new Error(`Out of bound path \"${canonicalDestDir}\" found while processing file ${entry.fileName}`)\n          }\n\n          await this.extractEntry(entry)\n          debug('finished processing', entry.fileName)\n          this.zipfile.readEntry()\n        } catch (err) {\n          this.canceled = true\n          this.zipfile.close()\n          reject(err)\n        }\n      })\n    })\n  }\n\n  async extractEntry (entry) {\n    /* istanbul ignore if */\n    if (this.canceled) {\n      debug('skipping entry extraction', entry.fileName, { cancelled: this.canceled })\n      return\n    }\n\n    if (this.opts.onEntry) {\n      this.opts.onEntry(entry, this.zipfile)\n    }\n\n    const dest = path.join(this.opts.dir, entry.fileName)\n\n    // convert external file attr int into a fs stat mode int\n    const mode = (entry.externalFileAttributes >> 16) & 0xFFFF\n    // check if it's a symlink or dir (using stat mode constants)\n    const IFMT = 61440\n    const IFDIR = 16384\n    const IFLNK = 40960\n    const symlink = (mode & IFMT) === IFLNK\n    let isDir = (mode & IFMT) === IFDIR\n\n    // Failsafe, borrowed from jsZip\n    if (!isDir && entry.fileName.endsWith('/')) {\n      isDir = true\n    }\n\n    // check for windows weird way of specifying a directory\n    // https://github.com/maxogden/extract-zip/issues/13#issuecomment-154494566\n    const madeBy = entry.versionMadeBy >> 8\n    if (!isDir) isDir = (madeBy === 0 && entry.externalFileAttributes === 16)\n\n    debug('extracting entry', { filename: entry.fileName, isDir: isDir, isSymlink: symlink })\n\n    const procMode = this.getExtractedMode(mode, isDir) & 0o777\n\n    // always ensure folders are created\n    const destDir = isDir ? dest : path.dirname(dest)\n\n    const mkdirOptions = { recursive: true }\n    if (isDir) {\n      mkdirOptions.mode = procMode\n    }\n    debug('mkdir', { dir: destDir, ...mkdirOptions })\n    await fs.mkdir(destDir, mkdirOptions)\n    if (isDir) return\n\n    debug('opening read stream', dest)\n    const readStream = await promisify(this.zipfile.openReadStream.bind(this.zipfile))(entry)\n\n    if (symlink) {\n      const link = await getStream(readStream)\n      debug('creating symlink', link, dest)\n      await fs.symlink(link, dest)\n    } else {\n      await pipeline(readStream, createWriteStream(dest, { mode: procMode }))\n    }\n  }\n\n  getExtractedMode (entryMode, isDir) {\n    let mode = entryMode\n    // Set defaults, if necessary\n    if (mode === 0) {\n      if (isDir) {\n        if (this.opts.defaultDirMode) {\n          mode = parseInt(this.opts.defaultDirMode, 10)\n        }\n\n        if (!mode) {\n          mode = 0o755\n        }\n      } else {\n        if (this.opts.defaultFileMode) {\n          mode = parseInt(this.opts.defaultFileMode, 10)\n        }\n\n        if (!mode) {\n          mode = 0o644\n        }\n      }\n    }\n\n    return mode\n  }\n}\n\nmodule.exports = async function (zipPath, opts) {\n  debug('creating target directory', opts.dir)\n\n  if (!path.isAbsolute(opts.dir)) {\n    throw new Error('Target directory is expected to be absolute')\n  }\n\n  await fs.mkdir(opts.dir, { recursive: true })\n  opts.dir = await fs.realpath(opts.dir)\n  return new Extractor(zipPath, opts).extract()\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}