{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HTTPResponse = void 0;\n\nconst SecurityDetails_js_1 = require(\"./SecurityDetails.js\");\n\nconst Errors_js_1 = require(\"./Errors.js\");\n/**\n * The HTTPResponse class represents responses which are received by the\n * {@link Page} class.\n *\n * @public\n */\n\n\nclass HTTPResponse {\n  /**\n   * @internal\n   */\n  constructor(client, request, responsePayload, extraInfo) {\n    this._contentPromise = null;\n    this._headers = {};\n    this._client = client;\n    this._request = request;\n    this._bodyLoadedPromise = new Promise(fulfill => {\n      this._bodyLoadedPromiseFulfill = fulfill;\n    });\n    this._remoteAddress = {\n      ip: responsePayload.remoteIPAddress,\n      port: responsePayload.remotePort\n    };\n    this._statusText = this._parseStatusTextFromExtrInfo(extraInfo) || responsePayload.statusText;\n    this._url = request.url();\n    this._fromDiskCache = !!responsePayload.fromDiskCache;\n    this._fromServiceWorker = !!responsePayload.fromServiceWorker;\n    this._status = extraInfo ? extraInfo.statusCode : responsePayload.status;\n    const headers = extraInfo ? extraInfo.headers : responsePayload.headers;\n\n    for (const key of Object.keys(headers)) this._headers[key.toLowerCase()] = headers[key];\n\n    this._securityDetails = responsePayload.securityDetails ? new SecurityDetails_js_1.SecurityDetails(responsePayload.securityDetails) : null;\n    this._timing = responsePayload.timing;\n  }\n  /**\n   * @internal\n   */\n\n\n  _parseStatusTextFromExtrInfo(extraInfo) {\n    if (!extraInfo || !extraInfo.headersText) return;\n    const firstLine = extraInfo.headersText.split('\\r', 1)[0];\n    if (!firstLine) return;\n    const match = firstLine.match(/[^ ]* [^ ]* (.*)/);\n    if (!match) return;\n    const statusText = match[1];\n    if (!statusText) return;\n    return statusText;\n  }\n  /**\n   * @internal\n   */\n\n\n  _resolveBody(err) {\n    return this._bodyLoadedPromiseFulfill(err);\n  }\n  /**\n   * @returns The IP address and port number used to connect to the remote\n   * server.\n   */\n\n\n  remoteAddress() {\n    return this._remoteAddress;\n  }\n  /**\n   * @returns The URL of the response.\n   */\n\n\n  url() {\n    return this._url;\n  }\n  /**\n   * @returns True if the response was successful (status in the range 200-299).\n   */\n\n\n  ok() {\n    // TODO: document === 0 case?\n    return this._status === 0 || this._status >= 200 && this._status <= 299;\n  }\n  /**\n   * @returns The status code of the response (e.g., 200 for a success).\n   */\n\n\n  status() {\n    return this._status;\n  }\n  /**\n   * @returns  The status text of the response (e.g. usually an \"OK\" for a\n   * success).\n   */\n\n\n  statusText() {\n    return this._statusText;\n  }\n  /**\n   * @returns An object with HTTP headers associated with the response. All\n   * header names are lower-case.\n   */\n\n\n  headers() {\n    return this._headers;\n  }\n  /**\n   * @returns {@link SecurityDetails} if the response was received over the\n   * secure connection, or `null` otherwise.\n   */\n\n\n  securityDetails() {\n    return this._securityDetails;\n  }\n  /**\n   * @returns Timing information related to the response.\n   */\n\n\n  timing() {\n    return this._timing;\n  }\n  /**\n   * @returns Promise which resolves to a buffer with response body.\n   */\n\n\n  buffer() {\n    if (!this._contentPromise) {\n      this._contentPromise = this._bodyLoadedPromise.then(async error => {\n        if (error) throw error;\n\n        try {\n          const response = await this._client.send('Network.getResponseBody', {\n            requestId: this._request._requestId\n          });\n          return Buffer.from(response.body, response.base64Encoded ? 'base64' : 'utf8');\n        } catch (error) {\n          if (error instanceof Errors_js_1.ProtocolError && error.originalMessage === 'No resource with given identifier found') {\n            throw new Errors_js_1.ProtocolError('Could not load body for this request. This might happen if the request is a preflight request.');\n          }\n\n          throw error;\n        }\n      });\n    }\n\n    return this._contentPromise;\n  }\n  /**\n   * @returns Promise which resolves to a text representation of response body.\n   */\n\n\n  async text() {\n    const content = await this.buffer();\n    return content.toString('utf8');\n  }\n  /**\n   *\n   * @returns Promise which resolves to a JSON representation of response body.\n   *\n   * @remarks\n   *\n   * This method will throw if the response body is not parsable via\n   * `JSON.parse`.\n   */\n\n\n  async json() {\n    const content = await this.text();\n    return JSON.parse(content);\n  }\n  /**\n   * @returns A matching {@link HTTPRequest} object.\n   */\n\n\n  request() {\n    return this._request;\n  }\n  /**\n   * @returns True if the response was served from either the browser's disk\n   * cache or memory cache.\n   */\n\n\n  fromCache() {\n    return this._fromDiskCache || this._request._fromMemoryCache;\n  }\n  /**\n   * @returns True if the response was served by a service worker.\n   */\n\n\n  fromServiceWorker() {\n    return this._fromServiceWorker;\n  }\n  /**\n   * @returns A {@link Frame} that initiated this response, or `null` if\n   * navigating to error pages.\n   */\n\n\n  frame() {\n    return this._request.frame();\n  }\n\n}\n\nexports.HTTPResponse = HTTPResponse;","map":{"version":3,"mappings":"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","names":["HTTPResponse","constructor","client","request","responsePayload","extraInfo","_client","_request","_bodyLoadedPromise","Promise","fulfill","_bodyLoadedPromiseFulfill","_remoteAddress","ip","remoteIPAddress","port","remotePort","_statusText","_parseStatusTextFromExtrInfo","statusText","_url","url","_fromDiskCache","fromDiskCache","_fromServiceWorker","fromServiceWorker","_status","statusCode","status","headers","key","Object","keys","_headers","toLowerCase","_securityDetails","securityDetails","SecurityDetails_js_1","_timing","timing","headersText","firstLine","split","match","_resolveBody","err","remoteAddress","ok","buffer","_contentPromise","then","error","response","send","requestId","_requestId","Buffer","from","body","base64Encoded","Errors_js_1","originalMessage","text","content","toString","json","JSON","parse","fromCache","_fromMemoryCache","frame","exports"],"sources":["../../../../src/common/HTTPResponse.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}